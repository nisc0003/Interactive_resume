---
import Heading from "./Heading.astro";
import Button from "./Button.astro";
import Skills from "./Skills.astro";
import Facebook from "../assets/Facebook.svg";
import Instagram from "../assets/Instagram.svg";
import LinkedIn from "../assets/Linkedin.svg";
---

<div
  class="bg-bg2 lg:col-span-4 lg:col-start-1 lg:row-start-1 lg:rounded-lg flex flex-col lg:min-h-screen md:px-0 px-4"
  x-data="sidebar"
  x-init="init()"
>
  <!-- First viewport: intro (top) + contact (bottom) -->
  <div class="flex flex-col lg:justify-between lg:min-h-screen">
    <div class="p-6 md:p-7 lg:p-8 flex-shrink-0" data-reveal>
      <Heading
        htmlheading="h1"
        type="hero2"
        font="display2"
        stylingclasses="text-text-white lg:text-left mb-6"
      >
        Studerende med passion for at skabe intuitive interfaces
      </Heading>
    </div>

    <div
      <div
      class="rounded-lg p-4 md:p-5 lg:p-10 xl:p-12 lg:mx-8 lg:mb-6 lg:bg-bg1 mb-12 lg:mt-auto lg:shrink xl:shrink-0"
      data-reveal
    >
      <Heading
        htmlheading="h3"
        type="div_heading"
        stylingclasses="text-text-white mb-4 lg:mb-6"
      >
        Kontakt mig
      </Heading>

      <div
        class="grid gap-4 md:gap-5 mb-4 md:mb-5 lg:mb-6 [grid-template-columns:repeat(auto-fit,minmax(240px,1fr))] justify-items-center"
      >
        <div class="hover:opacity-75 transition-opacity w-full max-w-[18rem]">
          <Button variant="privateMail" />
        </div>
        <div class="hover:opacity-75 transition-opacity w-full max-w-[18rem]">
          <Button variant="workMail" />
        </div>
        <div class="hover:opacity-75 transition-opacity w-full max-w-[18rem]">
          <Button variant="call" />
        </div>
      </div>

      <div class="pt-3 border-t border-white/10">
        <Heading
          htmlheading="h4"
          type="list_heading"
          font="display1"
          stylingclasses="text-text-white mb-4"
        >
          FÃ¸lg mig
        </Heading>
        <div class="flex items-center gap-5 sm:gap-6 md:gap-7">
          <a
            href="https://www.instagram.com/n.schousen/"
            target="_blank"
            rel="noopener noreferrer"
            class="hover:opacity-75 transition-opacity"
            aria-label="Instagram"
          >
            <img
              src={Instagram.src}
              alt="Instagram"
              class="w-9 h-9 sm:w-10 sm:h-10 md:w-11 md:h-11 lg:w-11 lg:h-11"
            />
          </a>
          <a
            href="https://www.linkedin.com/in/niscdesign/"
            target="_blank"
            rel="noopener noreferrer"
            class="hover:opacity-75 transition-opacity"
            aria-label="LinkedIn"
          >
            <img
              src={LinkedIn.src}
              alt="LinkedIn"
              class="w-9 h-9 sm:w-10 sm:h-10 md:w-11 md:h-11 lg:w-11 lg:h-11"
            />
          </a>
          <a
            href="https://www.facebook.com/nschousen"
            target="_blank"
            rel="noopener noreferrer"
            class="hover:opacity-75 transition-opacity"
            aria-label="Facebook"
          >
            <img
              src={Facebook.src}
              alt="Facebook"
              class="w-9 h-9 sm:w-10 sm:h-10 md:w-11 md:h-11 lg:w-11 lg:h-11"
            />
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Below the fold content as its own viewport -->
  <div class="flex flex-col lg:min-h-screen">
    <div class="p-4 md:p-5 lg:p-8 xl:p-12 flex-shrink-0" data-reveal>
      <Heading
        htmlheading="h1"
        type="hero2"
        font="display2"
        stylingclasses="text-text-white lg:text-left mb-6"
      >
        Digital Designer under konstruktion
      </Heading>
    </div>

    <div
      class="rounded-lg p-4 lg:p-10 xl:p-12 lg:mx-8 lg:mb-6 lg:bg-bg1 mb-12 lg:mt-auto"
      data-reveal
    >
      <Skills />
    </div>
  </div>
</div>

<script type="module" is:inline>
  import Alpine from "https://unpkg.com/alpinejs@3.12.0/dist/module.esm.js";
  window.Alpine = Alpine;

  Alpine.data("sidebar", () => ({
    revealObserver: null,
    mutationObserver: null,
    _cleanupFn: null,

    init() {
      const root = this.$el;
      this._cleanupFn = () => this._cleanup();

      if (!window.matchMedia("(min-width: 1024px)").matches) {
        root
          .querySelectorAll("[data-reveal]")
          .forEach((el) => el.classList.add("revealed"));
        return;
      }

      const revealEls = Array.from(root.querySelectorAll("[data-reveal]"));

      revealEls.forEach((el) => {
        const rect = el.getBoundingClientRect();
        if (rect.top < window.innerHeight && rect.bottom > 0)
          el.classList.add("revealed");
      });

      this.revealObserver = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("revealed");
              if (this.revealObserver)
                this.revealObserver.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.1, rootMargin: "0px 0px -10% 0px" },
      );

      revealEls.forEach((el) => {
        if (!el.classList.contains("revealed")) this.revealObserver.observe(el);
      });

      window.addEventListener("beforeunload", this._cleanupFn);

      this.mutationObserver = new MutationObserver(() => {
        if (!document.body.contains(root)) this._cleanup();
      });
      this.mutationObserver.observe(document, {
        childList: true,
        subtree: true,
      });
    },

    _cleanup() {
      if (this.revealObserver) {
        this.revealObserver.disconnect();
        this.revealObserver = null;
      }
      if (this.mutationObserver) {
        this.mutationObserver.disconnect();
        this.mutationObserver = null;
      }
      if (this._cleanupFn) {
        window.removeEventListener("beforeunload", this._cleanupFn);
        this._cleanupFn = null;
      }
    },

    // Alpine will call this when the component is removed
    destroy() {
      this._cleanup();
    },
  }));

  Alpine.start();
</script>
